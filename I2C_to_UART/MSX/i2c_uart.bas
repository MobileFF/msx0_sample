1 'SAVE"I2C_UART.BAS"
1000 'Init
1010   D$="3C"
1020   _IOTFIND("device/i2c_a",C)
1030   PRINT "IOTFIND:";C
1040   IF C=0 THEN 1200:'Not Found
1050   _IOTFIND("device/i2c_a",A$(0),C)
1060   PRINT "Slave Address : ";
1070   FOR I=0 TO C-1
1080     PRINT A$(I);" ";
1090     IF A$(I)=D$ THEN 1300:'Create Device Path
1100   NEXT I
1200 'Not Found
1210   PRINT "Device not found."
1220   END
1300 'Create Device Path
1310   N$="device/i2c_a/"+A$(I)

2000 'Main
2010   PRINT
2020   PRINT "---- DFPlayer Mini ----"

3000 'INIT
3010 PRINT "---- RESET ----"
3100 RESTORE 40000:'RESET
3120 GOSUB 20000:'RESET
3125 FOR I=0 TO 1000:NEXT I
3130 GOSUB 20000:'SET VOLUME
3140 GOSUB 20000:'REPEAT TRACK 1
3150 RESTORE 40300:'QUERY STATUS
3160 GOSUB 20000:'QUERY STATUS
3170 FOR I=0 TO 100:NEXT I
3180 GOTO 3150
9999 END

20000 'Write Multi Bytes
20100 READ LN
20110 READ NR
20120 PRINT "[";LN;",";NR;"]"
20200 T1$=CHR$(LN)+CHR$(NR)
20210 _IOTPUT(N$,T1$)
20300 T2$=""
20310 PRINT "[";
20320 FOR I=1 TO LN
20330   READ V$
20340   PRINT V$;",";
20350   T2$=T2$+CHR$(VAL("&H"+V$))
20360 NEXT I
20370 PRINT "]"
20380 _IOTPUT(N$,T2$)
20400 IF NR=0 THEN RETURN
20500 _IOTGET(N$,RP$)
20600 PRINT ">> ";
20610 IF LEN(RP$) = 0 THEN GOTO 20500
20620 FOR I=1 TO LEN(RP$)
20630 PRINT HEX$(ASC(MID$(RP$,I,1)));",";
20640 NEXT I
20650 PRINT
20999 RETURN


40000 'RESET
40010 DATA 8,0
40020 DATA 7E,FF,06,0C,00,00,00,EF
40100 'SET VOLUME
40110 DATA 8,0
40120 DATA 7E,FF,06,06,00,00,10,EF
40200 'REPEAT TRACK 1
40210 DATA 8,0
40220 DATA 7E,FF,06,08,00,00,01,EF
40300 'QUERY STATUS
40310 DATA 8,1
40320 DATA 7E,FF,06,42,00,00,00,EF

SAVE"I2C_UART.BAS"
