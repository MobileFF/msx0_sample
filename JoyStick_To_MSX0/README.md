# ATARI9ピンのジョイスティックをMSX0に接続するためのArduinoシールド用スケッチ<!-- omit in toc -->


## 能書き

MSX0にATARI9ピンのジョイスティック（いわゆるMSX用のジョイスティック）を接続するためのArduinoシールドを作ったのですが、その際に利用するスケッチです。

MSX側のサンプルコードは、MSX BASICでシンプルに`STICK()`関数や`STRIG()`関数を使ってジョイスティックの入力を確認するためのもので単なるサンプルコードなので実験に必須ではありません。

## ATARI9ピンジョイスティック（MSXジョイスティック）からの入力

MSXのジョイスティックは、正直回路的にはとてもシンプルで、5V電源とGND、各入力（上下左右AボタンBボタンの計６個）のスイッチからなるものです。（負論理への変換とかプルアップとかはさておくと）

ジョイスティックの各入力のピンは、Arduinoのデジタルピン2〜7につなぎます。

|信号|JOYSTICK   |Arduino UNO  |
|----|-----------|-------------|
|5V  |5ピン      |5V           |
|GND |8ピン/9ピン|GNDのどれか  |
|↑  |1ピン      |D2ピン       |
|↓  |2ピン      |D3ピン       |
|←  |3ピン      |D4ピン       |
|→  |4ピン      |D5ピン       |
|TR1 |6ピン      |D6ピン       |
|TR2 |7ピン      |D7ピン       |

ジョイスティックで入力を行うとそのピンは`LOW`(0V)になり、入力されていないときは`HIGH`(5V)になります。

これをArduino側では`digitalRead()`などで受信すればよいのです。
また、それぞれのデジタルピンはArduino側でプルアップ（未接続時=スイッチが押されていなくて通電されていないときにHIGHにする）させる必要があるので、`pinMode()`を`INPUT_PULLUP`と指定しています。


## ArduinoからMSX0への出力

MSX0ではジョイスティックからの入力はMSX0に付属しているFaces II JoyPadで行うようになっています。FacesII JoyPadは内部I2CでMSX0本体と通信しているので、それと同じように振る舞えば別のデバイスで代替することができます。

当方で調査したところ、ジョイパッドの入力とI2Cで送信されている値の対応は以下の通りでした。

|入力   |2進     |10進|16進|
|-------|--------|----|----|
|↑     |11111110|254 |FE  |
|↓     |11111101|253 |FD  |
|←     |11111011|251 |FB  |
|→     |11110111|247 |F7  |
|TR1    |11101111|253 |EF  |
|TR2    |11011111|253 |DF  |
|SELECT |10111111|191 |BF  |
|START  |01111111|127 |7F  |

ArduinoはI2Cスレーブとして、デジタルピン2〜7の入力内容に合わせて、上記の値をI2Cマスター（MSX0）に送り返すように処理すれば良いことになります。


## ArduinoとMSX0の接続

ArduinoとMSX0はI2Cケーブル(Groveケーブル)で接続することになります。

ArduinoとI2Cケーブル(Groveケーブル)との接続は以下のとおりです。

|I2C |Arduino |
|----|--------|
|SCL |A5/SCL  |
|SDA |A4/SDA  |
|5V  |5V      |
|GND |GND     |


## おことわり

上記件に関して、なにぶんにも、中の人は電子工作、電子回路については完全な素人なのでたいしてよくわかっていないことのほうが多いです。

記事の内容をお試しになる場合は、自己責任でお願いいたします。この記事にある通りのことを試してお手持ちの機器を破損しても中の人は一切の責任を負いません。

Arduinoは互換機含め様々入手経路があり、価格も安価なものがたくさんありますが、MSX0については、2023年10月時点で破損すると、基本的には一般販売開始を待つか、次のクラウドファンディングのリワード発送を待たなければいけなくなります。

このことに同意できない方は記事の内容を試されないようにお願いいたします。

以上
